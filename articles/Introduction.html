<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction • bennu</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">bennu</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.3.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Introduction.html">Introduction</a>
    </li>
    <li>
      <a href="../articles/simulation_validation_experiments.html">Simulation Validation Experiments</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/sempwn/bennu/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/sempwn/bennu/blob/main/vignettes/Introduction.Rmd" class="external-link"><code>vignettes/Introduction.Rmd</code></a></small>
      <div class="hidden name"><code>Introduction.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mc-stan.org/rstan/" class="external-link">rstan</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: StanHeaders</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; rstan version 2.32.7 (Stan version 2.32.2)</span></span>
<span><span class="co">#&gt; For execution on a local, multicore CPU with excess RAM we recommend calling</span></span>
<span><span class="co">#&gt; options(mc.cores = parallel::detectCores()).</span></span>
<span><span class="co">#&gt; To avoid recompilation of unchanged Stan programs, we recommend calling</span></span>
<span><span class="co">#&gt; rstan_options(auto_write = TRUE)</span></span>
<span><span class="co">#&gt; For within-chain threading using `reduce_sum()` or `map_rect()` Stan functions,</span></span>
<span><span class="co">#&gt; change `threads_per_chain` option:</span></span>
<span><span class="co">#&gt; rstan_options(threads_per_chain = 1)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sempwn.github.io/bennu/">bennu</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mc-stan.org/bayesplot/" class="external-link">bayesplot</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; This is bayesplot version 1.13.0</span></span>
<span><span class="co">#&gt; - Online documentation and vignettes at mc-stan.org/bayesplot</span></span>
<span><span class="co">#&gt; - bayesplot theme set to bayesplot::theme_default()</span></span>
<span><span class="co">#&gt;    * Does _not_ affect other ggplot2 plots</span></span>
<span><span class="co">#&gt;    * See ?bayesplot_theme_set for details on theme setting</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://mc-stan.org/rstan/reference/rstan_options.html" class="external-link">rstan_options</a></span><span class="op">(</span>auto_write <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>mc.cores <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## basic example code</span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_model_data.html">generate_model_data</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: `generate_model_data()` was deprecated in bennu 0.2.1.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Please use `model_random_walk_data()` instead.</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">This warning is displayed once every 8 hours.</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">Call `lifecycle::last_lifecycle_warnings()` to see where this warning was</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">generated.</span></span></span>
<span><span class="co"># note iter should be at least 2000 to generate a reasonable posterior sample</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/est_naloxone.html">est_naloxone</a></span><span class="op">(</span><span class="va">d</span>, iter <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Specifying the `id_cols` argument by position was deprecated in tidyr 1.3.0.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Please explicitly name `id_cols`, like `id_cols = regions`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> The deprecated feature was likely used in the <span style="color: #0000BB;">bennu</span> package.</span></span>
<span><span class="co">#&gt;   Please report the issue at <span style="color: #0000BB; font-style: italic;">&lt;https://github.com/sempwn/bennu/issues&gt;</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">This warning is displayed once every 8 hours.</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">Call `lifecycle::last_lifecycle_warnings()` to see where this warning was</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">generated.</span></span></span>
<span><span class="co">#&gt; 00 [ 60%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 60 / 100 [ 60%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 2: Iteration: 70 / 100 [ 70%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 70 / 100 [ 70%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 2: Iteration: 80 / 100 [ 80%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 80 / 100 [ 80%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 2: Iteration: 90 / 100 [ 90%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 90 / 100 [ 90%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 2: Iteration: 100 / 100 [100%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 2: </span></span>
<span><span class="co">#&gt; Chain 2:  Elapsed Time: 0.09 seconds (Warm-up)</span></span>
<span><span class="co">#&gt; Chain 2:                0.109 seconds (Sampling)</span></span>
<span><span class="co">#&gt; Chain 2:                0.199 seconds (Total)</span></span>
<span><span class="co">#&gt; Chain 2: </span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 100 / 100 [100%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: </span></span>
<span><span class="co">#&gt; Chain 1:  Elapsed Time: 0.082 seconds (Warm-up)</span></span>
<span><span class="co">#&gt; Chain 1:                0.122 seconds (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1:                0.204 seconds (Total)</span></span>
<span><span class="co">#&gt; Chain 1:</span></span>
<span><span class="co">#&gt; Warning: There were 7 divergent transitions after warmup. See</span></span>
<span><span class="co">#&gt; https://mc-stan.org/misc/warnings.html#divergent-transitions-after-warmup</span></span>
<span><span class="co">#&gt; to find out why this is a problem and how to eliminate them.</span></span>
<span><span class="co">#&gt; Warning: There were 1 chains where the estimated Bayesian Fraction of Missing Information was low. See</span></span>
<span><span class="co">#&gt; https://mc-stan.org/misc/warnings.html#bfmi-low</span></span>
<span><span class="co">#&gt; Warning: Examine the pairs() plot to diagnose sampling problems</span></span>
<span><span class="co">#&gt; Warning: The largest R-hat is NA, indicating chains have not mixed.</span></span>
<span><span class="co">#&gt; Running the chains for more iterations may help. See</span></span>
<span><span class="co">#&gt; https://mc-stan.org/misc/warnings.html#r-hat</span></span>
<span><span class="co">#&gt; Warning: Bulk Effective Samples Size (ESS) is too low, indicating posterior means and medians may be unreliable.</span></span>
<span><span class="co">#&gt; Running the chains for more iterations may help. See</span></span>
<span><span class="co">#&gt; https://mc-stan.org/misc/warnings.html#bulk-ess</span></span>
<span><span class="co">#&gt; Warning: Tail Effective Samples Size (ESS) is too low, indicating posterior variances and tail quantiles may be unreliable.</span></span>
<span><span class="co">#&gt; Running the chains for more iterations may help. See</span></span>
<span><span class="co">#&gt; https://mc-stan.org/misc/warnings.html#tail-ess</span></span>
<span><span class="fu"><a href="https://mc-stan.org/bayesplot/reference/MCMC-scatterplots.html" class="external-link">mcmc_pairs</a></span><span class="op">(</span><span class="va">fit</span>,</span>
<span>  pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sigma"</span>, <span class="st">"mu0"</span>, <span class="st">"zeta"</span><span class="op">)</span>,</span>
<span>  off_diag_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="Introduction_files/figure-html/run%20example%20model-1.png" width="700"></p>
<p>Return median and 90th percentiles for posterior samples</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mc-stan.org/posterior/" class="external-link">posterior</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; This is posterior version 1.6.1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'posterior'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:bayesplot':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     rhat</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:rstan':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     ess_bulk, ess_tail</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     mad, sd, var</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     %in%, match</span></span>
<span></span>
<span><span class="fu"><a href="https://mc-stan.org/posterior/reference/draws_summary.html" class="external-link">summarise_draws</a></span><span class="op">(</span><span class="va">fit</span>, <span class="fu"><a href="https://mc-stan.org/posterior/reference/draws_summary.html" class="external-link">default_summary_measures</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 222 × 7</span></span></span>
<span><span class="co">#&gt;    variable   mean median     sd    mad    q5   q95</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> sim_p[1]  0.257  0.241 0.082<span style="text-decoration: underline;">7</span> 0.079<span style="text-decoration: underline;">8</span> 0.144 0.396</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> sim_p[2]  0.261  0.256 0.073<span style="text-decoration: underline;">2</span> 0.074<span style="text-decoration: underline;">5</span> 0.154 0.403</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> sim_p[3]  0.258  0.255 0.060<span style="text-decoration: underline;">1</span> 0.047<span style="text-decoration: underline;">0</span> 0.168 0.364</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> sim_p[4]  0.243  0.240 0.052<span style="text-decoration: underline;">3</span> 0.047<span style="text-decoration: underline;">3</span> 0.165 0.335</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> sim_p[5]  0.243  0.233 0.059<span style="text-decoration: underline;">0</span> 0.051<span style="text-decoration: underline;">0</span> 0.158 0.346</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> sim_p[6]  0.242  0.234 0.057<span style="text-decoration: underline;">9</span> 0.048<span style="text-decoration: underline;">4</span> 0.158 0.338</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> sim_p[7]  0.230  0.230 0.041<span style="text-decoration: underline;">6</span> 0.037<span style="text-decoration: underline;">2</span> 0.167 0.298</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> sim_p[8]  0.242  0.241 0.041<span style="text-decoration: underline;">9</span> 0.038<span style="text-decoration: underline;">8</span> 0.168 0.309</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> sim_p[9]  0.243  0.238 0.046<span style="text-decoration: underline;">4</span> 0.047<span style="text-decoration: underline;">0</span> 0.172 0.319</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> sim_p[10] 0.252  0.248 0.046<span style="text-decoration: underline;">7</span> 0.041<span style="text-decoration: underline;">4</span> 0.186 0.336</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 212 more rows</span></span></span></code></pre></div>
<p>We can plot the posterior predictive distribution of the probability
of prior kit use and compare to simulated data using the
<code>plot_kit_use</code> function</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_kit_use.html">plot_kit_use</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">fit</span>, data <span class="op">=</span> <span class="va">d</span><span class="op">)</span></span></code></pre></div>
<p><img src="Introduction_files/figure-html/plot%20draws-1.png" width="700"></p>
<p>We can also plot the reported number of kits used along with the
posterior predictive distribution using the <code>plot_kit_use</code>
function with the <code>reported</code> argument set to
<code>TRUE</code></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_kit_use.html">plot_kit_use</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">fit</span>, reported <span class="op">=</span> <span class="cn">TRUE</span>, data <span class="op">=</span> <span class="va">d</span><span class="op">)</span></span></code></pre></div>
<p><img src="Introduction_files/figure-html/plot%20reported%20draws-1.png" width="700"></p>
<p>Alternatively, if we only want to plot certain regions we can include
that as an optional argument in the <code>plot_kit_use</code>
function</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_kit_use.html">plot_kit_use</a></span><span class="op">(</span></span>
<span>  model <span class="op">=</span> <span class="va">fit</span>, data <span class="op">=</span> <span class="va">d</span>,</span>
<span>  regions_to_plot <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="Introduction_files/figure-html/plot%20draws%20filter%20regions-1.png" width="700"></p>
<p>We can compare the posterior predictive check to the prior predictive
check by re-running the model without the likelihood by setting the
<code>run_estimation</code> parameter to <code>FALSE</code></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># note iter should be at least 2000 to generate a reasonable posterior sample</span></span>
<span><span class="va">prior_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/est_naloxone.html">est_naloxone</a></span><span class="op">(</span><span class="va">d</span>,</span>
<span>  run_estimation <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  iter <span class="op">=</span> <span class="fl">100</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: There were 31 divergent transitions after warmup. See</span></span>
<span><span class="co">#&gt; https://mc-stan.org/misc/warnings.html#divergent-transitions-after-warmup</span></span>
<span><span class="co">#&gt; to find out why this is a problem and how to eliminate them.</span></span>
<span><span class="co">#&gt; Warning: There were 2 transitions after warmup that exceeded the maximum treedepth. Increase max_treedepth above 10. See</span></span>
<span><span class="co">#&gt; https://mc-stan.org/misc/warnings.html#maximum-treedepth-exceeded</span></span>
<span><span class="co">#&gt; Warning: There were 2 chains where the estimated Bayesian Fraction of Missing Information was low. See</span></span>
<span><span class="co">#&gt; https://mc-stan.org/misc/warnings.html#bfmi-low</span></span>
<span><span class="co">#&gt; Warning: Examine the pairs() plot to diagnose sampling problems</span></span>
<span><span class="co">#&gt; Warning: The largest R-hat is NA, indicating chains have not mixed.</span></span>
<span><span class="co">#&gt; Running the chains for more iterations may help. See</span></span>
<span><span class="co">#&gt; https://mc-stan.org/misc/warnings.html#r-hat</span></span>
<span><span class="co">#&gt; Warning: Bulk Effective Samples Size (ESS) is too low, indicating posterior means and medians may be unreliable.</span></span>
<span><span class="co">#&gt; Running the chains for more iterations may help. See</span></span>
<span><span class="co">#&gt; https://mc-stan.org/misc/warnings.html#bulk-ess</span></span>
<span><span class="co">#&gt; Warning: Tail Effective Samples Size (ESS) is too low, indicating posterior variances and tail quantiles may be unreliable.</span></span>
<span><span class="co">#&gt; Running the chains for more iterations may help. See</span></span>
<span><span class="co">#&gt; https://mc-stan.org/misc/warnings.html#tail-ess</span></span>
<span><span class="fu"><a href="https://mc-stan.org/bayesplot/reference/MCMC-scatterplots.html" class="external-link">mcmc_pairs</a></span><span class="op">(</span><span class="va">prior_fit</span>,</span>
<span>  pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sigma"</span>, <span class="st">"mu0"</span>, <span class="st">"zeta"</span><span class="op">)</span>,</span>
<span>  off_diag_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="Introduction_files/figure-html/run%20prior-1.png" width="700"></p>
<p>We can compare the prior and posterior predictive distribution of the
probability of prior kit use using the <code>plot_kit_use</code>
function</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_kit_use.html">plot_kit_use</a></span><span class="op">(</span>prior <span class="op">=</span> <span class="va">prior_fit</span>, posterior <span class="op">=</span> <span class="va">fit</span>, data <span class="op">=</span> <span class="va">d</span><span class="op">)</span></span></code></pre></div>
<p><img src="Introduction_files/figure-html/plot%20compare%20prior%20posterior-1.png" width="700"></p>
<div class="section level2">
<h2 id="incorporating-different-priors">Incorporating different priors<a class="anchor" aria-label="anchor" href="#incorporating-different-priors"></a>
</h2>
<p>The default priors for the model are set to be weakly uninformative.
To change the default priors we can specify a <code>list</code> as
follows. Note that <code>c</code> is the prior of the region
coefficients, <code>mu0</code> is the intercept, <code>ct0</code> is the
initial conditions of the random walk, <code>zeta</code> is the standard
deviation of the random walk, and <code>sigma</code> is the standard
deviation of the error. In this example let’s set the variation month to
month to be smaller by setting the standard deviation of the prior for
<code>zeta</code> to 0.01.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nondefault_priors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  c <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>mu <span class="op">=</span> <span class="fl">0</span>, sigma <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>  ct0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>mu <span class="op">=</span> <span class="fl">0</span>, sigma <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>  zeta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>mu <span class="op">=</span> <span class="fl">0</span>, sigma <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span>,</span>
<span>  mu0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>mu <span class="op">=</span> <span class="fl">0</span>, sigma <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>  sigma <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>mu <span class="op">=</span> <span class="fl">0</span>, sigma <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">nondefault_prior_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/est_naloxone.html">est_naloxone</a></span><span class="op">(</span><span class="va">d</span>, iter <span class="op">=</span> <span class="fl">100</span>, priors <span class="op">=</span> <span class="va">nondefault_priors</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: There were 51 divergent transitions after warmup. See</span></span>
<span><span class="co">#&gt; https://mc-stan.org/misc/warnings.html#divergent-transitions-after-warmup</span></span>
<span><span class="co">#&gt; to find out why this is a problem and how to eliminate them.</span></span>
<span><span class="co">#&gt; Warning: There were 1 transitions after warmup that exceeded the maximum treedepth. Increase max_treedepth above 10. See</span></span>
<span><span class="co">#&gt; https://mc-stan.org/misc/warnings.html#maximum-treedepth-exceeded</span></span>
<span><span class="co">#&gt; Warning: Examine the pairs() plot to diagnose sampling problems</span></span>
<span><span class="co">#&gt; Warning: The largest R-hat is NA, indicating chains have not mixed.</span></span>
<span><span class="co">#&gt; Running the chains for more iterations may help. See</span></span>
<span><span class="co">#&gt; https://mc-stan.org/misc/warnings.html#r-hat</span></span>
<span><span class="co">#&gt; Warning: Bulk Effective Samples Size (ESS) is too low, indicating posterior means and medians may be unreliable.</span></span>
<span><span class="co">#&gt; Running the chains for more iterations may help. See</span></span>
<span><span class="co">#&gt; https://mc-stan.org/misc/warnings.html#bulk-ess</span></span>
<span><span class="co">#&gt; Warning: Tail Effective Samples Size (ESS) is too low, indicating posterior variances and tail quantiles may be unreliable.</span></span>
<span><span class="co">#&gt; Running the chains for more iterations may help. See</span></span>
<span><span class="co">#&gt; https://mc-stan.org/misc/warnings.html#tail-ess</span></span></code></pre></div>
<p>Compare the posterior using non-default priors to the posterior for
default priors,</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_kit_use.html">plot_kit_use</a></span><span class="op">(</span>`Default prior` <span class="op">=</span> <span class="va">fit</span>,</span>
<span>             `Non-default prior` <span class="op">=</span> <span class="va">nondefault_prior_fit</span>, data <span class="op">=</span> <span class="va">d</span><span class="op">)</span></span></code></pre></div>
<p><img src="Introduction_files/figure-html/plot%20compare%20prior%20posterior%20nondefault%20prior-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="random-walk-of-order-2-model">Random walk of order 2 model<a class="anchor" aria-label="anchor" href="#random-walk-of-order-2-model"></a>
</h2>
<p>The second model uses a random walk of order 1 to characterize the
time-dependence structure of the inverse logit probability of naloxone
use,</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>Δ</mi><mn>2</mn></msup><msub><mi>c</mi><mi>i</mi></msub><mo>=</mo><msub><mi>c</mi><mi>i</mi></msub><mo>−</mo><msub><mi>c</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>∼</mo><mi>N</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><msup><mi>τ</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\Delta^2c_i = c_i - c_{i+1} \sim N(0,\tau^{-1})  </annotation></semantics></math></p>
<p>The model can also be fit using a random walk of order 2 increments
for the inverse logit probability of naloxone use using the following
independent second order increments,</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>Δ</mi><mn>2</mn></msup><msub><mi>c</mi><mi>i</mi></msub><mo>=</mo><msub><mi>c</mi><mi>i</mi></msub><mo>−</mo><mn>2</mn><msub><mi>c</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>+</mo><msub><mi>c</mi><mrow><mi>i</mi><mo>+</mo><mn>2</mn></mrow></msub><mo>∼</mo><mi>N</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><msup><mi>τ</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\Delta^2c_i = c_i - 2c_{i+1} + c_{i+2} \sim N(0,\tau^{-1}) </annotation></semantics></math></p>
<p>This version of the model will produce smoother estimates of
probability of naloxone use in time.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># note iter should be at least 2000 to generate a reasonable posterior sample</span></span>
<span><span class="co"># note use `rw_type` to specify order of random walk</span></span>
<span><span class="va">rw2_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/est_naloxone.html">est_naloxone</a></span><span class="op">(</span><span class="va">d</span>,</span>
<span>  rw_type <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  iter <span class="op">=</span> <span class="fl">100</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: There were 11 divergent transitions after warmup. See</span></span>
<span><span class="co">#&gt; https://mc-stan.org/misc/warnings.html#divergent-transitions-after-warmup</span></span>
<span><span class="co">#&gt; to find out why this is a problem and how to eliminate them.</span></span>
<span><span class="co">#&gt; Warning: There were 38 transitions after warmup that exceeded the maximum treedepth. Increase max_treedepth above 10. See</span></span>
<span><span class="co">#&gt; https://mc-stan.org/misc/warnings.html#maximum-treedepth-exceeded</span></span>
<span><span class="co">#&gt; Warning: Examine the pairs() plot to diagnose sampling problems</span></span>
<span><span class="co">#&gt; Warning: The largest R-hat is NA, indicating chains have not mixed.</span></span>
<span><span class="co">#&gt; Running the chains for more iterations may help. See</span></span>
<span><span class="co">#&gt; https://mc-stan.org/misc/warnings.html#r-hat</span></span>
<span><span class="co">#&gt; Warning: Bulk Effective Samples Size (ESS) is too low, indicating posterior means and medians may be unreliable.</span></span>
<span><span class="co">#&gt; Running the chains for more iterations may help. See</span></span>
<span><span class="co">#&gt; https://mc-stan.org/misc/warnings.html#bulk-ess</span></span>
<span><span class="co">#&gt; Warning: Tail Effective Samples Size (ESS) is too low, indicating posterior variances and tail quantiles may be unreliable.</span></span>
<span><span class="co">#&gt; Running the chains for more iterations may help. See</span></span>
<span><span class="co">#&gt; https://mc-stan.org/misc/warnings.html#tail-ess</span></span>
<span><span class="fu"><a href="https://mc-stan.org/bayesplot/reference/MCMC-scatterplots.html" class="external-link">mcmc_pairs</a></span><span class="op">(</span><span class="va">rw2_fit</span>,</span>
<span>  pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sigma"</span>, <span class="st">"mu0"</span>, <span class="st">"zeta"</span><span class="op">)</span>,</span>
<span>  off_diag_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="Introduction_files/figure-html/rw%20order%202%20model-1.png" width="700"></p>
<p>Summarize random walk order 2 model draws</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://mc-stan.org/posterior/reference/draws_summary.html" class="external-link">summarise_draws</a></span><span class="op">(</span><span class="va">rw2_fit</span>, <span class="fu"><a href="https://mc-stan.org/posterior/reference/draws_summary.html" class="external-link">default_convergence_measures</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 222 × 4</span></span></span>
<span><span class="co">#&gt;    variable   rhat ess_bulk ess_tail</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> sim_p[1]   1.37     11.4     35.3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> sim_p[2]   1.42     10.2     84.9</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> sim_p[3]   1.28     14.4    100.0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> sim_p[4]   1.30     12.7    103. </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> sim_p[5]   1.10     34.2    134. </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> sim_p[6]   1.10     66.2    121. </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> sim_p[7]   1.10     85.0     72.1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> sim_p[8]   1.10     92.7    142. </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> sim_p[9]   1.07     84.0     35.0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> sim_p[10]  1.07    141.     153. </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 212 more rows</span></span></span></code></pre></div>
<p>We can compare two different model fits of the probability of prior
kit use to simulated data using the <code>plot_kit_use</code>
function</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_kit_use.html">plot_kit_use</a></span><span class="op">(</span>rw_1 <span class="op">=</span> <span class="va">fit</span>, rw_2 <span class="op">=</span> <span class="va">rw2_fit</span>, data <span class="op">=</span> <span class="va">d</span><span class="op">)</span></span></code></pre></div>
<p><img src="Introduction_files/figure-html/plot%20draws%20comparison-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="fit-missing-distribution-data">fit missing distribution data<a class="anchor" aria-label="anchor" href="#fit-missing-distribution-data"></a>
</h2>
<p>As distribution data are reported from sites some months may not be
reported. This would lead to a difference in the frequency of the orders
data and the distribution data. The model can account for these
differences and infer the distribution during missing months. See the
following example for generating distribution data once every three
months</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## basic example code</span></span>
<span><span class="va">d_missing</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_model_data.html">generate_model_data</a></span><span class="op">(</span>reporting_freq <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">times</span>, y <span class="op">=</span> <span class="va">Reported_Used</span>, color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">regions</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">d_missing</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 32 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_point()`).</span></span></code></pre></div>
<p><img src="Introduction_files/figure-html/data%20generation%20lower%20frequency-1.png" width="700"></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">missing_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/est_naloxone.html">est_naloxone</a></span><span class="op">(</span><span class="va">d_missing</span>,</span>
<span>  rw_type <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  iter <span class="op">=</span> <span class="fl">100</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;               0.266 seconds (Total)</span></span>
<span><span class="co">#&gt; Chain 1:</span></span>
<span><span class="co">#&gt; Warning: There were 11 divergent transitions after warmup. See</span></span>
<span><span class="co">#&gt; https://mc-stan.org/misc/warnings.html#divergent-transitions-after-warmup</span></span>
<span><span class="co">#&gt; to find out why this is a problem and how to eliminate them.</span></span>
<span><span class="co">#&gt; Warning: There were 1 transitions after warmup that exceeded the maximum treedepth. Increase max_treedepth above 10. See</span></span>
<span><span class="co">#&gt; https://mc-stan.org/misc/warnings.html#maximum-treedepth-exceeded</span></span>
<span><span class="co">#&gt; Warning: Examine the pairs() plot to diagnose sampling problems</span></span>
<span><span class="co">#&gt; Warning: The largest R-hat is NA, indicating chains have not mixed.</span></span>
<span><span class="co">#&gt; Running the chains for more iterations may help. See</span></span>
<span><span class="co">#&gt; https://mc-stan.org/misc/warnings.html#r-hat</span></span>
<span><span class="co">#&gt; Warning: Bulk Effective Samples Size (ESS) is too low, indicating posterior means and medians may be unreliable.</span></span>
<span><span class="co">#&gt; Running the chains for more iterations may help. See</span></span>
<span><span class="co">#&gt; https://mc-stan.org/misc/warnings.html#bulk-ess</span></span>
<span><span class="co">#&gt; Warning: Tail Effective Samples Size (ESS) is too low, indicating posterior variances and tail quantiles may be unreliable.</span></span>
<span><span class="co">#&gt; Running the chains for more iterations may help. See</span></span>
<span><span class="co">#&gt; https://mc-stan.org/misc/warnings.html#tail-ess</span></span>
<span><span class="fu"><a href="https://mc-stan.org/bayesplot/reference/MCMC-scatterplots.html" class="external-link">mcmc_pairs</a></span><span class="op">(</span><span class="va">missing_fit</span>,</span>
<span>  pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sigma"</span>, <span class="st">"mu0"</span>, <span class="st">"zeta"</span><span class="op">)</span>,</span>
<span>  off_diag_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="Introduction_files/figure-html/missing%20data%20inference-1.png" width="700"></p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_kit_use.html">plot_kit_use</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">missing_fit</span>, data <span class="op">=</span> <span class="va">d_missing</span><span class="op">)</span></span></code></pre></div>
<p><img src="Introduction_files/figure-html/plot%20draws%20with%20missing%20data-1.png" width="700"></p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_kit_use.html">plot_kit_use</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">missing_fit</span>, data <span class="op">=</span> <span class="va">d_missing</span>, reported <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="Introduction_files/figure-html/plot%20reported%20draws%20with%20missing%20data-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="change-scale-of-data">Change scale of data<a class="anchor" aria-label="anchor" href="#change-scale-of-data"></a>
</h2>
<p>the original model was designed for data aggregated into months. If
the order and distribution data is aggregated differently then this can
be incorporated into the model by updating the delay in reporting
distribution and the delay in ordering to distributing distribution.</p>
<p>The delay in ordering to distributing distribution is composed of a
gamma distribution with shape parameter
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>
and inverse scale parameter
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>β</mi><mo>=</mo><mn>1</mn><mi>/</mi><mi>θ</mi></mrow><annotation encoding="application/x-tex">\beta = 1/\theta</annotation></semantics></math>.
In order to update for example from monthly to weekly data, we can use
the following property of the gamma distribution,</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Γ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>c</mi><mi>x</mi><mo>;</mo><mi>α</mi><mo>,</mo><mi>β</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>Γ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo>;</mo><mi>α</mi><mo>,</mo><mi>β</mi><mi>/</mi><mi>c</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\Gamma(cx;\alpha,\beta) = \Gamma(x;\alpha,\beta/c)</annotation></semantics></math></p>
<p>To convert the delay distribution from month into week set
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mo>=</mo><mn>1</mn><mi>/</mi><mn>4</mn></mrow><annotation encoding="application/x-tex">c = 1/4</annotation></semantics></math>
as one over the approximate number of weeks in a month. The reporting
delay distribution is a simple vector of length 3 denoting the empirical
delay distribution. This can be expanded into months through
interpolation and normalization to retain its property as a probability
distribution. Example code (not run) is shown below. Note that these
distributions will need to be updated when considering another
jurisdiction,</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># monthly reporting delay distribution</span></span>
<span><span class="va">psi_vec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.7</span>, <span class="fl">0.2</span>, <span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="co"># convert to weeks using interpolation</span></span>
<span><span class="va">weekly_psi_vec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">psi_vec</span>, <span class="fl">4</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">psi_vec</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># properties of order to distributed delay distribution in months</span></span>
<span><span class="va">max_delays</span> <span class="op">&lt;-</span> <span class="fl">3</span></span>
<span><span class="va">delay_alpha</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="va">delay_beta</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span></span>
<span><span class="co"># convert to weeks</span></span>
<span><span class="va">weekly_max_delays</span> <span class="op">&lt;-</span> <span class="va">max_delays</span> <span class="op">*</span> <span class="fl">4</span></span>
<span><span class="va">weekly_delay_alpha</span> <span class="op">&lt;-</span> <span class="va">delay_alpha</span></span>
<span><span class="va">weekly_delay_beta</span> <span class="op">&lt;-</span> <span class="fl">0.25</span> <span class="op">*</span> <span class="va">delay_beta</span></span>
<span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/est_naloxone.html">est_naloxone</a></span><span class="op">(</span><span class="va">d</span>,</span>
<span>  psi_vec <span class="op">=</span> <span class="va">weekly_psi_vec</span>,</span>
<span>  max_delays <span class="op">=</span> <span class="va">weekly_max_delays</span>,</span>
<span>  delay_alpha <span class="op">=</span> <span class="va">weekly_delay_alpha</span>,</span>
<span>  delay_beta <span class="op">=</span> <span class="va">weekly_delay_beta</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Mike Irvine.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

      </footer>
</div>






  </body>
</html>
